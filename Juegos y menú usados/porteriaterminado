#include<stdio.h>
#include<windows.h>
#define H 45
#define V 13
void printc (char campo[V][H]);
void juego(char campo[V][H],int *bx,int *by,int *inp,int *finp);
int main()
{
    int bx,by,inp,finp;
    char campo[V][H];
    bx=6;//posicion x de la bola
    by=1;//posicion y de la bola
    inp=4;//fila de inicio de la porteria
    finp=7;//fila de fin de la porteria
    int i,j;
    for(i=0;i<V;i++)//bucle de los limites
    {
        for(j=0;j<H;j++)
        {
            if(i==0||i==V-1)
            {
                campo[i][j]='-';
            }
            else if(j==0||j==H-1)
            {
                campo[i][j]='|';
            }
            else
            {
                campo[i][j]=' ';
            }
        }
    }
    for(i=inp;i<=finp;i++)//bucle porteria
    {
        for(j=42;j<=43;j++)
        {
            if(i==inp||i==finp)
            {
                    campo[i][j]='-';
            }
            else
                if(j==43)
            {
                campo[i][j]='|';
            }
        }
    }
    juego(campo,&bx,&by,&inp,&finp);//funcion del juego
    return 0;
}
void printc (char campo[V][H])//funcion que imprime la matriz
{
    system("cls");
    int i,j;
    for(i=0;i<V;i++)
    {
        for(j=0;j<H;j++)
        {
            printf("%c",campo[i][j]);
        }
        printf("\n");
    }
}
void juego(char campo[V][H],int *bx,int *by,int *inp,int *finp)
{
    char enter;
    int cont=0,aux=-3,k;
    int puntuacion=0;
    setbuf(stdin,NULL);
    while(kbhit()!=1)//kbhit(mientras no se pulsa ninguna tecla se ejecuta el bucle)
    {
        campo[*bx][*by]='o';
        printc(campo);
        if(aux<0||cont>6)
        {
            for(int i=1;i<11;i++)
            {
                campo[i][43]=campo[i+1][43];
                campo[i][42]=campo[i+1][42];
                campo[i+1][42]=' ';
                campo[i+1][43]=' ';
            }
            aux=aux+1;
            if(aux==7)
            {
                cont=0;
                aux=0;
            }
            *inp=*inp-1;
            *finp=*finp-1;
        }
        else
        {
            for(int i=11;i>1;i--)
            {
                campo[i][43]=campo[i-1][43];
                campo[i][42]=campo[i-1][42];
                campo[i-1][42]=' ';
                campo[i-1][43]=' ';
            }
            cont=cont+1;
            *inp=*inp+1;
            *finp=*finp+1;
        }
        printf("pulsa x para disparar");
        Sleep(10);
    }
    do
    {
        campo[*bx][*by]='o';
        printc(campo);
        if(aux<0||cont>6)
        {
            for(int i=1;i<11;i++)
            {
                campo[i][43]=campo[i+1][43];
                campo[i][42]=campo[i+1][42];
                campo[i+1][42]=' ';
                campo[i+1][43]=' ';
            }
            aux=aux+1;
            if(aux==7)
            {
                cont=0;
                aux=0;
            }
            *inp=*inp-1;
            *finp=*finp-1;

        }
        else
        {
            for(int i=11;i>1;i--)
            {
                campo[i][43]=campo[i-1][43];
                campo[i][42]=campo[i-1][42];
                campo[i-1][42]=' ';
                campo[i-1][43]=' ';
            }
            cont=cont+1;
            *inp=*inp+1;
            *finp=*finp+1;
        }
        if(enter!='x')
        {
            printf("pulsa x para disparar\n");
            enter=getch();
        }
        if(enter=='x')
        {
            *by=*by+1;
            campo[*bx][*by -1]=' ';
        }
        if((campo[*inp+1][42]=='o')||(campo[*finp-1][42]=='o'))//gol
            puntuacion=1;

        if((campo[*inp][42]=='o')||(campo[*finp][42]=='o'))//palo
            puntuacion=2;

        if(campo[6][43]=='o'||campo[5][43]=='o'||campo[7][43]=='o')
            puntuacion=3;

        Sleep(10);
    }while(puntuacion==0);

    printf("%d",puntuacion);
}
